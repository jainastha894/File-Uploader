<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Data</title>
    <link rel="stylesheet" href="/styles/mydata.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“ My Data</h1>
            <p>Manage your personal files and folders</p>
        </div>

        <!-- Main Card -->
        <div class="main-card">
            <!-- Navigation -->
            <div class="navigation">
                <a href="/uploads" class="nav-link">ğŸ“¤ Upload</a>
                <a href="/data" class="nav-link">ğŸ‘¥ Data</a>
                <a href="/mydata" class="nav-link active">ğŸ“ My Data</a>
            </div>

            <h2 class="section-title">My Files & Folders (<%= sessionUsername %>)</h2>

            <div class="success-message" id="successMessage"></div>

            <!-- Stats Bar -->
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-number" id="totalFiles">
                        <%=objects.totalObjects%>
                    </div>
                    <div class="stat-label">Files</div>
                </div>
                <!-- <div class="stat-item">
                    <div class="stat-number" id="totalFolders"></div>
                    <div class="stat-label">Folders</div>
                </div> -->
                <div class="stat-item">
                    <div class="stat-number" id="totalSize">
                        <%= objects.totalSize %> KB
                    </div>
                    <div class="stat-label">Total Size</div>
                </div>
            </div>

            <!-- Data Panel -->
            <div class="data-panel">
                <div class="panel-header">
                    <h3 class="panel-title">ğŸ“‚ Your Files</h3>

                </div>

                <div class="search-sort-bar">
                    <input type="text" id="searchInput" placeholder="Search files and folders..." class="search-input">
                </div>

                <div id="myDataContent">
                    <!-- User's files will be displayed here -->
                    <% if (result.length===0) { %>
                        <div class="empty-state">
                            You have no files or folders. Start by uploading some files!
                        </div>
                        <% } else { %>
                            <div id="dataList" class="data-list">
                                <% result.forEach(item=> { %>
                                    <!-- Example for files -->
                                    <div class="data-item file-item" data-name="<%= item.key %>" data-type="file"
                                        data-date="<%= item.LastModified %>">
                                        <div class="item-icon">ğŸ“„</div>
                                        <a href="<%=item.url%>" class="item-name" style="text-decoration:none; color: black;" target="_blank" download>
                                            <%= item.key %>
                                        </a>
                                        <div class="item-actions">
                                            <button class="action-btn"
                                                onclick="openRenameModal('<%= item.key%>')">âœï¸</button>
                                          
                                            <button class="action-btn"
                                                onclick="window.location.href='/delete?key=<%=item.key%>'" >ğŸ—‘ï¸</button>
                                        </div>
                                    </div>
                                    <% }) %>
                            </div>
                            <% } %>

                </div>
            </div>
        </div>

        <!-- Rename Modal -->
        <form action="/rename" method="post" id="renameModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">Rename Item</div>
                <input type="text" name="newName" class="modal-input" placeholder="Enter new name">
                <input type="hidden" id="itemKeyInput" name="itemKeyInput">
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeRenameModal()">Cancel</button>
                    <button class="btn btn-primary" type="submit">Rename</button>
                </div>
            </div>
        </form>
        <script>
            function openRenameModal(itemKey) {
                document.getElementById('renameModal').style.display = 'block';
                document.getElementById('itemKeyInput').value = itemKey;    

               }
            function closeRenameModal() {
                document.getElementById('renameModal').style.display = 'none';
            }

            const searchInput = document.getElementById('searchInput');
            const dataList = document.getElementById('dataList');

            function searchFiles(){
                const query= searchInput.value.toLowerCase();
                const dataItems=Array.from(dataList.getElementsByClassName('data-item'));
                dataItems.forEach((item)=>{
                    const name= item.getAttribute('data-name').toLowerCase();
                    if(name.includes(query)){
                        item.style.display='flex';
                    } else {
                        item.style.display='none';
                    }
                });
            }


            searchInput.addEventListener('input', searchFiles);

                
        </script>
</body>

</html>